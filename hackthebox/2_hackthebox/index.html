<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Oopsie | Parro </title> <meta name="author" content="Parro "> <meta name="description" content="A walkthrough of the HackTheBox Oopsie machine."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%A1&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://parroquet.github.io/hackthebox/2_hackthebox/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Parro </span></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/hackthebox/">Hackthebox</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Oopsie</h1> <p class="post-description">A walkthrough of the HackTheBox Oopsie machine.</p> </header> <article> <h2 id="basic-setup">Basic Setup:</h2> <ul> <li>sudo openvpn Parro-startingpoint.ovpn</li> <li>Join the machine from HTB website</li> </ul> <h3 id="begin---nmap-scan">Begin: - nmap scan</h3> <p>The first step once again is to run an nmap scan. The nmap command i used here was:</p> <blockquote> <p><strong>sudo nmap -sS -A 10.10.10.28</strong></p> </blockquote> <p><img src="../2_img/oopsienmap.png" alt="oopsienmap" width="750"></p> <p>This nmap scan shows us clearly that a http server on port 80 is up and this means that our entry point for root will be through here. It is good to note that the type of web server they are using is Apache/2.4.29 Ubuntu. This could potentially be checked with metasploit to find any exploits which are available for this version of Apache.</p> <h3 id="continuing-to-the-website">Continuing to the website:</h3> <p>If we simply place the ip of the machine inside firefox we see a web page appear!</p> <p><img src="../2_img/web.png" alt="web" width="750"></p> <p>My first idea here is to recursively search for directories which are located on the web page if any. For this, a selection of tools is available but I chose to use <strong>dirbuster</strong> which provides a gui for the user to enter in details such as the ip, port, location of wordlists to enumerate through and any extra details such as number of threads to use.</p> <p><img src="../2_img/dirbuster.png" alt="dirbuster" width="750"></p> <p>When running dirbuster, the first directory that stands out is the cdn-cgi/login/index.php which makes me think there is some sort of login page which we can bruteforce…</p> <p><img src="../2_img/loginpage.png" alt="loginpage" width="750"></p> <p>I was correct, a login page seems to be available to potentially exploit. At this point, we can leave dirbuster running in the background to see if it can find any more interesting directories, but for now, lets try to exploit this login page!</p> <p>An idea here could be to reuse the admin username and the MEGACORP_4dm1n!! password we found on the Archetype machine.</p> <p><img src="../2_img/loggedin.png" alt="loggedin" width="750"></p> <p>After trying this, turns out it worked! Looking closely at the tabs for this page, we see a uploads page, and a clients page. These will be useful for the next step. My initial thoughts here is to upload a reverse php shell on the uploads page. But as we can see, the page is only available to super admins.</p> <p><img src="../2_img/superadmin.png" alt="superadmin" width="750"></p> <p>As we can see, super admin rights are needed here. There seems to be a clients page aswell which provides ids. I believe this can easily be changed in the cookies to get access to a super admin account.</p> <p><img src="../2_img/superid.png" alt="superid" width="750"></p> <p>Eventually, after a while of looking (couldve made a script to do it), we have found the id of the super admin!</p> <p><img src="../2_img/idfound.png" alt="idfound" width="750"></p> <p>My plan here is to change the cookies to have the new id and try to go access the uploads page after a refresh.</p> <p><img src="../2_img/uploadpage.png" alt="uploadpage" width="750"></p> <p>Just as I expected, a file upload page is available. Lets now change the ip and port in php-reverse-shell.php to my own and upload this file!</p> <p><img src="../2_img/uploaded.png" alt="uploaded" width="750"></p> <p>Now that the php code has been uploaded, lets run this buy heading over to the at <strong>10.10.10.28/uploads/php-reverse-shell.php</strong>. And…</p> <p><img src="../2_img/shell.png" alt="shell" width="750"></p> <p>We finally have a shell!! Basic shell upgrades will be done here for a fully functioning shell.</p> <p><img src="../2_img/shellupgrade.png" alt="shellupgrade" width="750"></p> <p>To do this, we run these set of commands and we should have a fully upgraded and nice shell to use to exploit the machine some more! Now to find the user flag! For this we head to the home directory first.</p> <p><img src="../2_img/robert.png" alt="robert" width="750"></p> <p>We found a user, and his name is robert. User.txt is also visible for us which is perfect! Now time to get root. As we explore further, we see that roberts username and password are located in the directory <strong>/var/www/html/cdn-cgi/login/db.php</strong>. This contained robert’s username and password <strong>M3g4c0rpUs3r!</strong>. We can then use to su to robert!</p> <p><img src="../2_img/access.png" alt="access" width="750"> As we can see here, we are part of a bugtracker group. It also appears to have an suid bit set which is not safe at all. First we will run the program in <strong>/usr/bin/bugtracker</strong>.</p> <p><img src="../2_img/bugtracker.png" alt="bugtracker" width="750"></p> <p>When running bug tracker, we see this interesting output. It appears that when we enter a bug ID, all it seems to do is <strong>cat</strong> the file from the reports folder in the root directory!</p> <p>In this case, if we changed the cat command to instead start a shell for us, it would allow us to have root access to the machine.</p> <p><img src="../2_img/malicious.png" alt="malicious" width="750"></p> <p>After running these commands, we have created our malicious cat command. This command will now instead start a shell for us instead of outputting the contents of a file to the user. Running the program again should allow us root access, lets try it!</p> <p><img src="../2_img/root.png" alt="root" width="750"></p> <p>VOILA! We now have acquired root. We can find the root flag in /root/root.txt. Finally we have some post exploitation information:</p> <p>Inside /root directory, we see a .config file. Inside this file is a filezilla.xml file. When we read this we see user as ftpuser and password as mc@F1l3zilL4. This is a great find and should help us with our next machine!</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Parro . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>