<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Archetype | Parro </title> <meta name="author" content="Parro "> <meta name="description" content="A walkthrough of the HackTheBox Archetype machine."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%A1&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://parroquet.github.io/hackthebox/1_hackthebox/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Parro </span></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/hackthebox/">Hackthebox</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Archetype</h1> <p class="post-description">A walkthrough of the HackTheBox Archetype machine.</p> </header> <article> <h2 id="basic-setup">Basic Setup:</h2> <ul> <li>sudo openvpn Parro-startingpoint.ovpn</li> <li>Join the machine from HTB website</li> </ul> <h3 id="begin---scanning">Begin: - Scanning</h3> <p>The first step I tend to take with any of these machines as a beginner is to port scan using the nmap command. I ran the command:</p> <blockquote> <p><strong>sudo nmap -sS -Pn -A 10.10.10.27</strong></p> </blockquote> <p><img src="../1_img/nmap1.png" alt="nmap1" width="750"> <img src="../1_img/nmap2.png" alt="nmap2" width="750"></p> <p>Important information we see here is the msrpc and ms-sql-s being open ports. We also tend to note the version of these. SQL appears to be a 2017 server which could be vulnerable to metasploit exploits. But the main thing we see is that sql is running samba which is notoriously known for being vulnerable.</p> <h3 id="exploiting-samba">Exploiting Samba:</h3> <p>We first check if we login with no password and we get shown and using -L for list which allows for us to see which shares are available on the machine. We see here that there are backups so my first idea is to login to the backups section. It worked!</p> <p>Now we can <strong>ls</strong> to see any files in the current directory and we see <strong>prod.dtsConfig</strong> file with data inside. We can then run <strong>get prod.dtsConfig</strong> to move this file to our computer for further inspection.</p> <p><img src="../1_img/smb.png" alt="smb" width="750"></p> <p>We then <strong>cat</strong> this file and lo and behold, the Password = M3g4c0rp123 with the USER ID = ARCHETYPE\sql_svc was saved in this file. We can also assume that the SQL server we saw when doing our nmap scan uses this in some way so lets try it!</p> <p><img src="../1_img/smbimg.png" alt="smbimg" width="750"></p> <p>With persistent research online, we can use a program named mssqlclient.py to get access to the SQL server here. To do this, we used the command:</p> <blockquote> <p><strong>/usr/share/doc/python3-impacket/examples/mssqlclient.py ARCHETYPE/sql_svc@10.10.10.27 -windows-auth</strong></p> </blockquote> <p>This command allows us to login successfully!</p> <p>From this point we can then look for what privileges we have. Firstly, we check if we have any sudo privileges using:</p> <blockquote> <p><strong>SELECT IS_SRVROLEMEMBER(‘sysadmin’)</strong></p> </blockquote> <p>And it returns 1, meaning we are. Great!</p> <p>We then check what user we are using the command:</p> <blockquote> <p><strong>SELECT current_user</strong></p> </blockquote> <p>This shows that we are user <strong>dbo</strong> and we have sysadmin privileges!</p> <p><img src="../1_img/sqllogin.png" alt="sqllogin" width="750"></p> <p>We can then run xp_cmdshell to see if we can execute powershell commands and we can!</p> <p>This is great because now we can work towards getting a reverse shell to access the SQL server from our own computer.</p> <p>Firstly, we searched for powershell reverse shell code and we find: <img src="../1_img/pscode.png" alt="pscode" width="750"></p> <p>Next we shall, run a listener on our computer, open a http server with python to serve the pscode file and run a powershell command to read from this web server and execute the code for a reverse shell connection to take place.</p> <p><img src="../1_img/reversetime.png" alt="reversetime" width="750"></p> <p>We then run the top command and voila! Access granted! We are now the user archetype\sql_svc</p> <p><img src="../1_img/gainingaccess.png" alt="gainingaccess" width="750"></p> <p>We then run a command to check the powershell console log and we see an ADMIN password!!</p> <p><img src="../1_img/adminpass.png" alt="adminpass" width="750"></p> <p>We can the use PSExec tool to gain admin access to the machine using:</p> <blockquote> <p><strong>/usr/share/doc/python3-impacket/examples/psexec.py administrator@10.10.10.27</strong></p> </blockquote> <p>and entering the password - MEGACORP_4dm1n!! we found in the console log.</p> <p><img src="../1_img/finished.png" alt="finished" width="750"></p> <p>We can see here we have system access and as we traverse to the Desktop, we see the root.txt file and Archetype box has been conquered!</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Parro . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>